<?xml version="1.0" encoding="UTF-8"?>
<svg width="920" height="500" xmlns="http://www.w3.org/2000/svg">
  <title>cutileGPT Architecture Diagram</title>
  <desc>A diagram showing the 100% Non-PyTorch architecture of cutileGPT, from the Application Layer down to the NVIDIA GPU Hardware.</desc>
  <style>
    .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; text-anchor: middle; fill: #333; }
    .layer-rect { stroke-width: 2px; rx: 8px; }
    .layer-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; text-anchor: middle; }
    .layer-subtitle { font-family: Arial, sans-serif; font-size: 13px; text-anchor: middle; fill: #555; }
    .layer-desc { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; fill: #666; }
    .kernel-rect { stroke-width: 2px; rx: 6px; }
    .kernel-title { font-family: Arial, sans-serif; font-size: 12px; font-weight: bold; text-anchor: middle; fill: #fff; }
    .kernel-subtitle { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: #fff; }
    .kernel-desc { font-family: Arial, sans-serif; font-size: 9px; text-anchor: middle; }
  </style>

  <defs>
    <marker id="architecture-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>

  <text x="460" y="30" class="title">cutileGPT Architecture: 100% Non-PyTorch</text>

  <!-- Application Layer -->
  <g>
    <rect x="60" y="60" width="800" height="80" fill="#e8f5e9" stroke="#76b900" class="layer-rect"/>
    <text x="460" y="88" class="layer-title" fill="#5a8f00">Application Layer (Python)</text>
    <text x="460" y="110" class="layer-subtitle">CutileGPT Model • Weight Management • Generation Logic</text>
    <text x="460" y="128" class="layer-desc">(100% CuPy - No PyTorch dependency)</text>
  </g>

  <!-- Array Management & GPU Kernels -->
  <g>
    <rect x="60" y="160" width="380" height="100" fill="#e0f7fa" stroke="#00bcd4" class="layer-rect"/>
    <text x="250" y="188" class="layer-title" fill="#00838f">Array Management</text>
    <text x="250" y="210" class="layer-subtitle">CuPy (NumPy-compatible)</text>
    <text x="250" y="228" font-family="Arial, sans-serif" font-size="11px" text-anchor="middle" fill="#666">• Memory allocation</text>
    <text x="250" y="244" font-family="Arial, sans-serif" font-size="11px" text-anchor="middle" fill="#666">• Shape operations</text>

    <rect x="480" y="160" width="380" height="100" fill="#fff3e0" stroke="#ff9800" class="layer-rect"/>
    <text x="670" y="188" class="layer-title" fill="#e65100">GPU Kernels</text>
    <text x="670" y="210" class="layer-subtitle">NVIDIA cutile (cuda.tile)</text>
    <text x="670" y="228" font-family="Arial, sans-serif" font-size="11px" text-anchor="middle" fill="#666">• Tile-based programming</text>
    <text x="670" y="244" font-family="Arial, sans-serif" font-size="11px" text-anchor="middle" fill="#666">• Custom CUDA kernels</text>
  </g>

  <!-- Kernel Components -->
  <g transform="translate(60, 280)">
    <g>
      <rect x="0" y="0" width="130" height="60" fill="#76b900" stroke="#5a8f00" class="kernel-rect"/>
      <text x="65" y="25" class="kernel-title">Linear</text>
      <text x="65" y="42" class="kernel-subtitle">MatMul + 2D Swizzle</text>
      <text x="65" y="55" class="kernel-desc" fill="#e8f5e9">TMA • TF32</text>
    </g>
    <g>
      <rect x="134" y="0" width="130" height="60" fill="#00bcd4" stroke="#00838f" class="kernel-rect"/>
      <text x="199" y="25" class="kernel-title">Attention</text>
      <text x="199" y="42" class="kernel-subtitle">Flash Attention</text>
      <text x="199" y="55" class="kernel-desc" fill="#e0f7fa">Online Softmax</text>
    </g>
    <g>
      <rect x="268" y="0" width="130" height="60" fill="#ff9800" stroke="#e65100" class="kernel-rect"/>
      <text x="333" y="25" class="kernel-title">LayerNorm</text>
      <text x="333" y="42" class="kernel-subtitle">Welford Algorithm</text>
      <text x="333" y="55" class="kernel-desc" fill="#fff3e0">Single-pass</text>
    </g>
    <g>
      <rect x="402" y="0" width="130" height="60" fill="#76b900" stroke="#5a8f00" class="kernel-rect"/>
      <text x="467" y="25" class="kernel-title">GELU</text>
      <text x="467" y="42" class="kernel-subtitle">Activation</text>
      <text x="467" y="55" class="kernel-desc" fill="#e8f5e9">GPT-2 approx</text>
    </g>
    <g>
      <rect x="536" y="0" width="130" height="60" fill="#00bcd4" stroke="#00838f" class="kernel-rect"/>
      <text x="601" y="25" class="kernel-title">Embedding</text>
      <text x="601" y="42" class="kernel-subtitle">Lookup</text>
      <text x="601" y="55" class="kernel-desc" fill="#e0f7fa">Gather op</text>
    </g>
    <g>
      <rect x="670" y="0" width="130" height="60" fill="#ff9800" stroke="#e65100" class="kernel-rect"/>
      <text x="735" y="25" class="kernel-title">Fused MLP</text>
      <text x="735" y="42" class="kernel-subtitle">3-in-1 Kernel</text>
      <text x="735" y="55" class="kernel-desc" fill="#fff3e0">Bandwidth ↓</text>
    </g>
  </g>

  <!-- Hardware Layer -->
  <g>
    <rect x="60" y="360" width="800" height="80" fill="#263238" stroke="#000" class="layer-rect"/>
    <text x="460" y="388" class="layer-title" fill="#76b900">NVIDIA GPU Hardware</text>
    <text x="460" y="410" class="layer-subtitle" fill="#90a4ae">Blackwell (SM_121) • Hopper (SM_100) • Tensor Cores • TMA</text>
    <text x="460" y="428" font-family="Arial, sans-serif" font-size="11px" text-anchor="middle" fill="#b0bec5">CUDA 13.0+ • Compute Capability 10.x / 12.x</text>
  </g>

  <!-- Arrows -->
  <line x1="250" y1="260" x2="250" y2="280" stroke="#666" stroke-width="2" marker-end="url(#architecture-arrowhead)"/>
  <line x1="670" y1="260" x2="670" y2="280" stroke="#666" stroke-width="2" marker-end="url(#architecture-arrowhead)"/>
  <line x1="460" y1="340" x2="460" y2="360" stroke="#666" stroke-width="2" marker-end="url(#architecture-arrowhead)"/>

  <!-- No PyTorch Badge -->
  <g>
    <circle cx="830" cy="100" r="35" fill="#f44336" opacity="0.9"/>
    <line x1="805" y1="85" x2="855" y2="115" stroke="#fff" stroke-width="5" stroke-linecap="round"/>
    <text x="830" y="155" font-family="Arial, sans-serif" font-size="11px" font-weight="bold" text-anchor="middle" fill="#f44336">No PyTorch!</text>
  </g>
</svg>
